{% extends "base_admin.html" %}
{% load staticfiles i18n permission_tags %}
{% block title %} {% trans "Controle" %}{% endblock %}

{% block menu %} {% include 'repatriate/_menu_admin.html' %} {% endblock %}
{% block content %}
    <h4>Desk Contôle de {{user.site}} </h4>

    <div class="row">
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
            <table class="table table-sm table-bordered" style="text-align: center;">
                <thead>
                    <tr><th colspan="8">Situation hebdo.</th></tr>
                    <tr class="thead-msah"><th>Nombre de ménage</th><th>Données désagrégées</th><th>Bébés (0-4 ans)</th>
                        <th>Enfant (5-11 ans)</th><th>Enfant (12-17 ans)</th><th>Adultes (18-59 ans)</th>
                        <th>Personnes (+ de 60 ans)</th><th>TOTAL</th></tr></thead>
                </thead>
                <tbody class="">
                    <tr>
                        <td rowspan="4" style="font-size: 2em;">{{nb_menage}}</td>
                        <tr><th> M </th><td>{{pn_0_4_count_m}}</td><td>{{pn_5_11_count_m}}</td><td>{{pn_12_17_count_m}}</td><td>{{pn_18_59_count_m}}</td><td>{{plus60_count_m}}</td><td>{{nb_person_m}}</td></tr>
                        <tr><th> F </th><td>{{pn_0_4_count_f}}</td><td>{{pn_5_11_count_f}}</td><td>{{pn_12_17_count_f}}</td><td>{{pn_18_59_count_f}}</td><td>{{plus60_count_f}}</td><td>{{nb_person_f}}</td></tr>
                        <tr style="background-color:  black;color: white;"><th>Total</th>
                            <th> {{pn_0_4_count}}</th>
                            <th> {{pn_5_11_count}}</th>
                            <th> {{pn_12_17_count}}</th>
                            <th> {{pn_18_59_count}}</th>
                            <th> {{plus60_count}}</th>
                            <th> {{nb_person}}</th>
                        </tr>
                    </tr>
                  </tbody>
                </table>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <form action= {% url 'controle' %} method="post"> {% csrf_token %}
                <div  class="form-group">
                    <div>Début {{period_form.star_date}} </div>
                    <div>fin {{period_form.end_date}}</div>
                    <input type="submit" name="_per_Date" class="btn btn-sm btn-primary" value="Export xls pour" />
                </div>
            </form>
            <form action= {% url 'controle' %} class="form-group"  method="post"> {% csrf_token %}
                <div  class="form-group">
                    <div> {{search_form.num_progres_individuel}} <input type="submit" name="_search" class="btn btn-sm btn-primary" value="OK" /></div>
                </div>
            </form>
            <h6>{{msg_result}}</h6>
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <table class="table table-sm table-bordered table-striped">
                <thead class="thead-msah"><th colspan="4">
                    <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Alertes </th>
                </thead>
                <tbody >
                    {% if invalide_num_progres_menage %}
                    <tr class="table-warning"><th colspan="3">Numéro progres ménage invalide.</th></tr>
                        {% for el in invalide_num_progres_menage %}
                        <tr><td>Enquête faite par <b> {{el.nom_agent }}</b>  le {{el.date_entretien}} à <b>{{el.site_engistrement}}</b></td><td>
                          <a class="btn btn-warning btn-sm" href="{{el.get_absolute_url}}"><em class="fa fa-check-circle "></em> Corriger</a></td></tr>
                        {% endfor %}
                    {% endif %}
                    {% if invalide_num_pi %}
                        <tr class="table-warning"><th colspan="3">Numéro progres individuel invalide.</th></tr>
                        {% for el in invalide_num_pi %}
                        <tr><td>Enquête faite par <b> {{el.target.nom_agent }} </b>  le {{el.target.date_entretien}} à <b>{{el.target.site_engistrement}}.</b></td><td>
                          <a class="btn btn-warning btn-sm" href="{{el.validated_url}}"><em class="fa fa-check-circle "></em> Corriger</a></td></tr>
                        {% endfor %}
                    {% endif %}
                    <tr class="table-warning"><th colspan="3">Numéro progres ménage avec le pays d'asile Algerie.</th></tr>
                    {% for el in not_empty_num_progres_menage_alg %}
                        <tr><td>Enquête faite par <b> {{el.nom_agent }} </b>  le {{el.date_entretien}}</td><td>
                          <a class="btn btn-warning btn-sm" href="{{el.validated_url}}"><em class="fa fa-check-circle "></em> Corriger</a></td></tr>
                    {% endfor %}
                    <tr class="table-warning"><th colspan="2">Numéro du site non attribué.</th></tr>
                    {% for el in site_not_existe %}
                        <tr><td>Enquête faite par <b> {{el.nom_agent }} </b>  le {{el.date_entretien}}</td><td>
                          <a class="btn btn-warning btn-sm" href="{{el.validated_url}}"><em class="fa fa-check-circle "></em> Corriger</a></td></tr>
                    {% endfor %}
                    <tr class="table-warning"><th colspan="2">Numéro de téléphone non valide.</th></tr>
                    {% for el in invalide_num_tel %}
                        <tr><td>Enquête faite par <b> {{el.nom_agent }} </b>  le {{el.date_entretien}}</td><td>
                          <a class="btn btn-warning btn-sm" href="{{el.validated_url}}"><em class="fa fa-check-circle "></em> Corriger</a></td></tr>
                    {% endfor %}
                    <tr class="table-warning"><th colspan="2">Ménage sans membre.</th></tr>
                    {% for el in zero_member %}
                        <tr><td>Enquête faite par <b> {{el.nom_agent }} </b>  le {{el.date_entretien}}</td><td>
                          <a class="btn btn-warning btn-sm" href="{{el.validated_url}}"><em class="fa fa-check-circle "></em> Corriger</a></td></tr>
                    {% endfor %}
                    <tr class="table-warning"><th colspan="2">Ménage avec plusieurs chef.</th></tr>
                    {% for el in many_chef_menage %}
                        <tr><td>Enquête faite par <b> {{el.nom_agent }} </b>  le {{el.date_entretien}}</td><td>
                          <a class="btn btn-warning btn-sm" href="{{el.validated_url}}"><em class="fa fa-check-circle "></em> Corriger</a></td></tr>
                    {% endfor %}
                    <tr class="table-warning"><th colspan="2">Ménage sans chef.</th></tr>
                    {% for el in no_chef_manage %}
                        <tr><td>Enquête faite par <b> {{el.nom_agent }} </b>  le {{el.date_entretien}}</td><td>
                          <a class="btn btn-warning btn-sm" href="{{el.validated_url}}"><em class="fa fa-check-circle "></em> Corriger</a></td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% if user|has_role:'desk_assistant_admin, desk_admin' %}
        <hr/>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <table class="table table-sm table-bordered table">
                    <thead class="thead-msah"><th colspan="4">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Contôle doublons</th>
                        </thead><tbody class="">
                        <tr class="table-warning"><th colspan="2">Numéro progres ménage</th></tr>
                        <tr><td>kddd jdjdjd</td></tr>
                        <tr class="table-warning"><th colspan="2">Numéro progres individuel</th></tr>
                        <tr><td>kddd jdjdjd</td></tr>
                      </tbody>
                </table>
            </div>
        </div>
    {% endif %}


{% endblock %}
